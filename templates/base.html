<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Event Scheduler{% endblock %}</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Modern Event Scheduling & Resource Allocation System with conflict detection">
    <meta name="theme-color" content="#7C3AED">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“…</text></svg>">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<!-- Particles Background -->
<div id="particles-js" style="position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1;"></div>

<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="{{ url_for('index') }}">
            <i class="bi bi-calendar-event"></i>
            <span>EventFlow</span>
        </a>
        <div class="d-flex align-items-center gap-2 order-lg-last">
            <!-- Theme Toggle -->
            <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                <i class="bi bi-moon-stars-fill" id="themeIcon"></i>
            </button>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto me-3">
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}"
                        href="{{ url_for('index') }}">
                        <i class="bi bi-speedometer2 me-1"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if 'event' in request.endpoint %}active{% endif %}"
                        href="{{ url_for('events') }}">
                        <i class="bi bi-calendar3 me-1"></i>Events
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if 'resource' in request.endpoint %}active{% endif %}"
                        href="{{ url_for('resources') }}">
                        <i class="bi bi-box-seam me-1"></i>Resources
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'allocate' %}active{% endif %}"
                        href="{{ url_for('allocate') }}">
                        <i class="bi bi-link-45deg me-1"></i>Allocate
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'report' %}active{% endif %}"
                        href="{{ url_for('report') }}">
                        <i class="bi bi-bar-chart me-1"></i>Report
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Flash Messages -->
<div class="container mt-3">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show fade-in" role="alert">
        {% if category == 'success' %}
        <i class="bi bi-check-circle-fill"></i>
        {% elif category == 'danger' %}
        <i class="bi bi-x-circle-fill"></i>
        {% elif category == 'warning' %}
        <i class="bi bi-exclamation-triangle-fill"></i>
        {% else %}
        <i class="bi bi-info-circle-fill"></i>
        {% endif %}
        {{ message|safe }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
</div>

<!-- Main Content -->
<main class="container my-4">
    {% if is_home %}
    <!-- Dashboard Content -->
    <div class="page-header fade-in">
        <h1><i class="bi bi-speedometer2"></i>Dashboard</h1>
        <p>Welcome to EventFlow - Your smart event scheduling solution</p>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            <div class="stats-card fade-in glow-on-hover">
                <div class="stats-icon primary">
                    <i class="bi bi-calendar-event"></i>
                </div>
                <div class="stats-number">{{ events_count }}</div>
                <div class="stats-label">Total Events</div>
                <a href="{{ url_for('events') }}" class="btn btn-primary btn-sm mt-3">
                    View Events <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="stats-card fade-in glow-on-hover">
                <div class="stats-icon success">
                    <i class="bi bi-box-seam"></i>
                </div>
                <div class="stats-number">{{ resources_count }}</div>
                <div class="stats-label">Total Resources</div>
                <a href="{{ url_for('resources') }}" class="btn btn-success btn-sm mt-3">
                    View Resources <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
        
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card fade-in">
                <div class="card-header">
                    <i class="bi bi-lightning-charge"></i>Quick Actions
                </div>
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-3">
                        <a href="{{ url_for('add_event') }}" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i>Add Event
                        </a>
                        <a href="{{ url_for('add_resource') }}" class="btn btn-success">
                            <i class="bi bi-plus-circle"></i>Add Resource
                        </a>
                        <a href="{{ url_for('allocate') }}" class="btn btn-info">
                            <i class="bi bi-link-45deg"></i>Allocate Resources
                        </a>
                        <a href="{{ url_for('report') }}" class="btn btn-secondary">
                            <i class="bi bi-bar-chart"></i>Generate Report
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Events -->
    {% if recent_events %}
    <div class="card fade-in">
        <div class="card-header">
            <i class="bi bi-clock-history"></i>Recent Events
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Resources</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in recent_events %}
                        <tr>
                            <td><strong>{{ event.title }}</strong></td>
                            <td>{{ event.start_time.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>{{ event.end_time.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>
                                {% for allocation in event.allocations %}
                                <span class="badge bg-{{ allocation.resource.type }}">
                                    {{ allocation.resource.name }}
                                </span>
                                {% else %}
                                <span class="text-muted">None</span>
                                {% endfor %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    {% else %}
    {% block content %}{% endblock %}
    {% endif %}
</main>

<!-- Footer -->
<footer class="footer text-center">
    <div class="container">
        <p class="mb-2">
            <strong>EventFlow</strong> - Event Scheduling & Resource Allocation System
        </p>
        <p class="mb-0 small">
            devloped by priyan 
            <span class="mx-2"></span>
            
        </p>
    </div>
</footer>

<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Particles.js Library -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<!-- Theme Toggle Script -->
<script>
    // Particles Initialization
    particlesJS('particles-js', {
        "particles": {
            "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#7C3AED" },
            "shape": { "type": "circle" },
            "opacity": { "value": 0.2, "random": false },
            "size": { "value": 3, "random": true },
            "line_linked": { "enable": true, "distance": 150, "color": "#7C3AED", "opacity": 0.1, "width": 1 },
            "move": { "enable": true, "speed": 2, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false }
        },
        "interactivity": {
            "detect_on": "canvas",
            "events": { "onhover": { "enable": true, "mode": "repulse" }, "onclick": { "enable": true, "mode": "push" }, "resize": true },
            "modes": { "repulse": { "distance": 100, "duration": 0.4 }, "push": { "particles_nb": 4 } }
        },
        "retina_detect": true
    });

    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const html = document.documentElement;

    // Check for saved theme preference
    const savedTheme = localStorage.getItem('theme') || 'dark';
    html.setAttribute('data-theme', savedTheme);
    updateThemeIcon(savedTheme);

    themeToggle.addEventListener('click', function () {
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
    });

    function updateThemeIcon(theme) {
        if (theme === 'dark') {
            themeIcon.className = 'bi bi-moon-stars-fill';
        } else {
            themeIcon.className = 'bi bi-sun-fill';
        }
    }

    // Add animation class to elements on scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.fade-in').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'all 0.5s ease-out';
        observer.observe(el);
    });
</script>

{% block scripts %}{% endblock %}
</body>

</html>